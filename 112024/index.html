<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.21.16/dist/css/uikit.min.css" />
    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.16/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.16/dist/js/uikit-icons.min.js"></script>
    <title>How Do Markets React Under Pressure: A Behavioral Study</title>
</head>
<body>
    <div class="uk-container uk-margin-top">
        <div class="uk-h2 uk-text-bold uk-margin-remove">
            How Do Markets React Under Pressure
        </div>
        <div class="uk-h4 uk-text-bold uk-margin-remove">A Behavioral Study</div>

        <div uk-alert>
            <div class="uk-h4 uk-text-bold">Important Notes for Participants</div>
            <div>
                Thank you very much for taking your time for this survey.
                Your responses will remain anonymous and will only be used for academic purposes.
                Please read the scenario carefully and provide honest answers.
                At the end of the survey, you will receive a completion code to submit on Prolific.
                Thank you for contributing to this brief but important research! Your input is highly valued.
            </div>
        </div>

        <a class="uk-button uk-button-primary" href="#modal-start" uk-toggle >Start Survey</a>
    </div>

    <div class="uk-modal" id="modal-start" uk-modal>
        <div class="uk-modal-dialog">
            <button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
            <div class="uk-modal-header">
                <div class="uk-h3 uk-text-bold uk-margin-remove">Welcome to the Survey</div>
            </div>
            <div class="uk-modal-body" uk-overflow-auto>
                <div class="uk-h4 uk-text-bold">Before starting the survey, tell me about yourself</div>
                <div uk-alert>
                    <div>
                        <div class="uk-h5 uk-text-bold uk-margin-remove">
                            Where is your current location?
                        </div>
                        <select class="uk-select" id="_countries" onchange="selectCurrency(this)"></select>
                    </div>
                </div>
                <div class="uk-hidden uk-alert-primary" uk-alert>
                    If you have <span class="uk-text-bold" id="_question"></span> prepared for the next week payment, what would you do?
                    <ol class="uk-list">
                        <li>
                            <label>
                                <input type="radio" name="_answer" value="1" />
                                Keep the money in your <b>bank account</b>
                            </label>
                        </li>
                        <li>
                            <label>
                                <input type="radio" name="_answer" value="2" />
                                Get a <b>lottery</b> that gives you <span class="uk-text-bold" id="_lottery"></span> by 10% of chance!
                            </label>
                        </li>
                    </ol>
                    <hr />
                    <p>
                        <label for="_agree" class="uk-text-small">
                            <input type="checkbox" id="_agree" />
                            I agree to participate in the survey
                        </label>
                    </p>
                    <button class="uk-button uk-button-primary" onclick="submitAnswer(this)">Submit</button>
                </div>
            </div>
        </div>
    </div>
    <script type="javascript" src="https://github.com/deraclab/deraclab.github.io/blob/main/data/TotalValueAdded2002.js"></script>
    <script>
        localStorage.clear();
        const dataSetup = new dataSetupLocal();
        const data = dataSetup.getData();
        console.log('data', data);
        dataSetup.datalist('_countries');
        const selectCurrency = (element, endowment = 1000) => {
            const currency = element.options[element.selectedIndex].dataset.currency;
            const base = dataSetup.normalize(element.value)*endowment;
            const len = parseInt(base).toString().length;
            const denom = Math.pow(10,len-1);
            const amount = Math.round(base/denom)*denom;
            const formatter = new Intl.NumberFormat('en-US');
            const _uestionElement = document.getElementById('_question');
            _uestionElement.innerHTML = formatter.format(amount) + ' ' + dataSetup.pluralize(currency);
            _uestionElement.parentElement.classList.remove('uk-hidden');
            document.getElementById('_lottery').innerHTML = formatter.format(amount*2) + ' ' + dataSetup.pluralize(currency);
        }
        const submitAnswer = (element) => {
            const countries = document.getElementById('_countries');
            const id = countries.value;
            const country = countries.options[countries.selectedIndex].text;
            const currency = countries.options[countries.selectedIndex].dataset.currency;
            const answer = document.querySelector('input[name="_answer"]:checked');
            if(id !== "" && answer !== null){
                localStorage.setItem('country', id);
                localStorage.setItem('risk_prefs', answer.value);
            }else{
                UIkit.modal.alert('Please select a country and answer the question.');
                return;
            }
            const agree = document.getElementById('_agree');
            if(!agree.checked){
                UIkit.modal.alert('Please agree to participate in the survey.');
                return;
            }
            return location.replace('./instructions.html');
        }
        document.getElementById('modal-start').addEventListener('beforeshow', function() {
            console.log('Modal is about to be shown');
        });
    </script>
</body>
</html>